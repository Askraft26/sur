<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>AR Hiro + Porsche GLB (VR world + gestes)</title>

  <!-- A-Frame + AR.js + Gestures -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #info {
      position: absolute; bottom: 20px; left: 0; width: 100%;
      text-align: center; color: white; font-family: system-ui, -apple-system, Arial, sans-serif;
      background: rgba(0,0,0,0.6); padding: 10px; box-sizing: border-box;
      pointer-events: none; z-index: 100;
    }
    #hud {
      position: absolute; top: 12px; left: 12px; z-index: 101;
      background: rgba(0,0,0,0.55); color: #fff; padding: 8px 10px;
      border-radius: 10px; font-family: system-ui, -apple-system, Arial, sans-serif;
      font-size: 13px;
    }
  </style>
</head>

<body>
  <div id="hud">ðŸ“¦ Chargement du modÃ¨leâ€¦</div>
  <div id="info">ðŸ”µ Pointez le marqueur Hiro â†’ la Porsche apparaÃ®t. Pincez/drag/rotate pour manipuler.</div>

  <a-scene embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; trackingMethod: best;"
    renderer="logarithmicDepthBuffer: true; antialias: true; colorManagement: true; physicallyCorrectLights: true;"
    vr-mode-ui="enabled:false"
  >
    <a-assets timeout="60000">
      <!-- Fichier GLB dans le MÃŠME dossier que index.html -->
      <a-asset-item id="porsche" src="free_porsche_911_carrera_4s.glb"></a-asset-item>

      <!-- Grid (effet sol VR) -->
      <img id="grid" src="https://cdn.aframe.io/a-painter/images/grid.png">
    </a-assets>

    <!-- ===== MARQUEUR HIRO ===== -->
    <a-marker preset="hiro" id="marker" emitevents="true"
      smooth="true" smoothCount="12" smoothTolerance="0.01" smoothThreshold="2"
    >
      <!-- Monde VR/3D attachÃ© au marker -->
      <a-entity id="vr-world" position="0 0 0" scale="1 1 1">

        <!-- Sol (semi transparent) -->
        <a-circle radius="3" rotation="-90 0 0" position="0 0 0"
          material="src:#grid; repeat:8 8; transparent:true; opacity:0.18; color:#4FC3F7">
        </a-circle>

        <!-- LumiÃ¨res -->
        <a-light type="ambient" intensity="0.9"></a-light>
        <a-light type="directional" intensity="0.85" position="2 5 3"></a-light>

        <!-- Titre -->
        <a-text value="PORSCHE AR" position="0 1.05 0" rotation="-90 0 0"
          align="center" width="2" color="#FFC65D">
        </a-text>

        <!-- Porsche (interactable) -->
        <a-entity
          id="car"
          class="interactable"
          gltf-model="#porsche"
          visible="false"
          position="0 0 0"
          rotation="0 0 0"
          scale="0.05 0.05 0.05"
          gesture-handler="minScale: 0.005; maxScale: 0.12"
        ></a-entity>

        <!-- Petit repÃ¨re dÃ©coratif -->
        <a-box position="0 0.25 -0.7" width="0.12" height="0.12" depth="0.12" color="#4FC3F7"
          animation="property: rotation; to: 0 360 0; dur: 4000; loop: true">
        </a-box>

      </a-entity>
    </a-marker>

    <!-- CamÃ©ra -->
    <a-entity camera="near:0.01; far:1000"></a-entity>
  </a-scene>

  <script>
    const hud = document.getElementById('hud');
    const car = document.getElementById('car');
    const marker = document.getElementById('marker');

    // Affiche quand le marker est trouvÃ©/perdu
    marker.addEventListener('markerFound', () => {
      hud.textContent = "âœ… Marker dÃ©tectÃ©. Chargement / affichageâ€¦";
    });
    marker.addEventListener('markerLost', () => {
      hud.textContent = "ðŸ”µ Cherche le marker Hiroâ€¦";
    });

    // Chargement modÃ¨le
    car.addEventListener('model-loaded', () => {
      car.setAttribute('visible', 'true');
      hud.textContent = "âœ… ModÃ¨le chargÃ©. Pince/drag/rotate pour manipuler.";
      setTimeout(() => { hud.style.display = "none"; }, 2500);
    });

    car.addEventListener('model-error', (e) => {
      hud.textContent = "âŒ Erreur GLB. VÃ©rifie le nom du fichier + GitHub Pages (https).";
      console.log("model-error", e);
    });

    // Petit â€œtap feedbackâ€ sur objet
    car.addEventListener('click', () => {
      car.setAttribute('scale', '0.022 0.022 0.022');
      setTimeout(() => car.setAttribute('scale', '0.02 0.02 0.02'), 160);
    });
  </script>
</body>
</html>

